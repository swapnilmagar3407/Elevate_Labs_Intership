import requests
from scanner.checks import (
    check_sql_injection,
    check_xss,
    check_open_redirect,
    check_csrf,
)

def scan_url(url):
    findings = []

    try:
        resp = requests.get(url, timeout=5)
        if resp.status_code == 200:
            findings.append({"info": "Target is reachable", "severity": "Low", "port": "80/443"})
    except Exception as e:
        findings.append({"error": f"Could not reach target: {e}", "severity": "High", "port": "N/A"})
        return findings

    # Define checks with severity levels
    checks = [
        (check_sql_injection, "High", "80/443"),
        (check_xss, "High", "80/443"),
        (check_open_redirect, "Medium", "80/443"),
        (check_csrf, "Medium", "80/443"),
    ]

    for check_func, severity, port in checks:
        result = check_func(url)
        if result:
            result["severity"] = severity
            result["port"] = port
            findings.append(result)

    return findings
